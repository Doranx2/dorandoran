<!DOCTYPE html>
<html lang="ko"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layouts/layout}">
	  
	<!-- head 영역 시작 -->
	<!-- 개별적으로 사용할 css, js 링크 걸기 위해 남겨둠 -->
<head>
		<th:block layout:fragment="script">
			<script th:inline="javascript">
				$(function() {
					
					// id 중복체크 여부 확인
					var checkId = false;

					// password가 확인 일치 여부
					var pwCheck = false;
					
					$("#pwCheckResult").hide();
					
					//id 중복체크
					$("#btnIdCheck").on("click", function() {
						$.ajax({
							url: "/user/idCheck",
							type: "post",
							data: $("#joinForm").serialize(),
							success: function(obj) {
								console.log(obj);
								
								if(obj.item.msg == 'duplicatedId') {
									alert("중복된 아이디입니다.");
									$("#userId").focus();
								} else {
									if(confirm("사용가능한 아이디입니다. " + $("#userId").val() + 
											"를(을) 사용하시겠습니까?")) {
										checkId = true;
										$("#btnIdCheck").attr("disabled", true);
									}
								}
							},
							error: function(e) {
								console.log(e);
							}
						})
					});
					//비밀번호 확인까지 입력한 후 다시 비밀번호 재설정
					if($("#userPw").val() == $("#userPwCheck").val()) {
						pwCheck = true;
						$("#pwCheckResult").css("color", "green");
						$("#pwCheckResult").text("비밀번호가 일치합니다.");
					} else {
						pwCheck = false;
						$("#pwCheckResult").css("color", "red");
						$("#pwCheckResult").text("비밀번호가 일치하지 않습니다.");
						}
					});
					//비밀번호 확인란 입력할 때 일치여부 체크
					$("#userPwCheck").on("change", function() {
						$("#pwCheckResult").show();
						
						if($("#userPw").val() == $("#userPwCheck").val()) {
							pwCheck = true;
							$("#pwCheckResult").css("color", "green");
							$("#pwCheckResult").text("비밀번호가 일치합니다.");
						} else {
							pwCheck = false;
							$("#pwCheckResult").css("color", "red");
							$("#pwCheckResult").text("비밀번호가 일치하지 않습니다.");
						}
					});
					$("#joinForm").on("submit", function(e) {
						e.preventDefault();
						
						// 아이디 중복체크 안 한 경우 및 중복된 아이디를 사용한 경우
						if(!checkId) {
							alert("아이디 중복체크를 진행하세요.");
							$("#userId").focus();
							return;
						}
						//비밀번호와 비밀번호 확인이 일치하지 않을 경우
						if(!pwCheck) {
							alert("비밀번호가 일치하지 않습니다.");
							$("#userPwCheck").focus();
							return;
						}
						$.ajax({
							url: '/user/join',
							type: 'post',
							data: $("#joinForm").serialize(),
							success: function(obj) {
								console.log(obj);
								if(obj.item.joinMsg == 'joinSuccess') {
									alert("회원가입에 성공하였습니다.");
									window.location.href="/user/login";
								} else {
									alert("회원가입에 실패하였습니다.");
									return;
								}
							},
							error: function(e) {
								console.log(e);
						}
				});
			});
			</script>
		</th:block>
		
		<th:block layout:frament="css">
			<style>
				body {
					height: 100%;
				}
			</style>
		</th:block>
	</head>
	<!-- head 영역 끝 -->
	<body>
	<div layout:fragment="content">
		<div class="join-D6e">
			<form id="joinForm" action="/user/join" method="post">
		  <p class="join-Lwx">JOIN</p>
	  	<div class="auto-group-rjqn-Sk6">
		    <div class="line-2-yEE"></div>
		    <p class="item--WV4">*필수입력사항</p>
	  	</div>
		  <div class="line-3-bWW"></div>
		  	<div class="auto-group-4cdg-YAr">
		    	<div class="auto-group-euft-fFU">
		      	<p class="item--zHk">
		        <span class="item--zHk-sub-0">아이디 </span>
		        <span class="item--zHk-sub-1">*</span>
  		      	<input type="text" id="userId" name="userId" class="rectangle-52-AdU" required>
		      	</p>
		      <p class="item--U6S">
		        <span class="item--U6S-sub-0">비밀번호 </span>
		        <span class="item--U6S-sub-1">*</span>
  		      	<input type="text" id="userPw" name="userPw" class="rectangle-53-V9x" required>

		      </p>
		    </div>
		    <div class="auto-group-fchg-TUA">
		      <div class="rectangle-52-AdU"></div>
		      <div class="rectangle-53-V9x"></div>
		    </div>
		    <div class="idcheckbtn-owL">
		      <button type="button" class="rectangle-53-Ytv">
				  <div class="item--fyY">중복아이디체크</div>
			  </button>
		    </div>
		  </div>
		  <div class="auto-group-q4e6-KoC">
		    <p class="item--ro8">
		      <span class="item--ro8-sub-0">비밀번호 확인 </span>
		      <span class="item--ro8-sub-1">*</span>
		    </p>
		    <div class="rectangle-54-E2z">
		    </div>
		  </div>
		  <div class="auto-group-auhp-kGE">
		    <p class="item--g9t">
		      <span class="item--g9t-sub-0">닉네임 </span>
		      <span class="item--g9t-sub-1">*</span>
  		      <input type="text" id="userNick" name="userNick" class="rectangle-55-JsQ" required>
		    </p>
		  </div>
		  <p class="item--CnS">
		    <span class="item--CnS-sub-0">지역 </span>
		    <span class="item--CnS-sub-1">*</span>
		  </p>
		  <div class="auto-group-izrk-ygi">
		    <p class="item--72E">
		      <span class="item--72E-sub-0">이메일 </span>
		      <span class="item--72E-sub-1">*</span>
		      <input type="email" id="userEmail" name="userEmail" class="rectangle-55-JsQ" required>
		    </p>
		  </div>
		  <p class="item--2YW">성별</p>
		  <div class="auto-group-entz-vtn">
		    <p class="item--Tti">생일</p>
		    <div class="auto-group-d6a6-nRC">
		      <div class="rectangle-57-Xdg">
		      </div>
		      <p class="yyyy-mm-dd-SVk">yyyy / mm / dd</p>
		    </div>
		  </div>
		  <div class="auto-group-3qan-9f4">
		    <div class="rectangle-98-HmG"></div>
		    <button type="submit" class="item--qGz">가입하기</button>
		   		</div>
		   	</form>
		  </div>
		</div>
	</body>
</html>