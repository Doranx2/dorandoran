<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">

<!-- head 영역 시작 -->
<!-- 개별적으로 사용할 css, js 링크 걸기 위해 남겨둠 -->

<head>
	<th:block layout:fragment="script">
		<script th:inline="javascript">

			$(function () {

				$("#updateHelp").hide();
				let updateCheck = /*[[${update}]]*/;


				if (!updateCheck) {
					console.log("INSERT!");

					const inputImage = document.getElementById("input-image")
					inputImage.addEventListener("change", e => {
						readImage(e.target)
					});

				} else {
					console.log("UPDATE!");
					$("#insertHelp").hide();
					$("#updateHelp").show();

					const helpTitle = /*[[${help.helpTitle}]]*/;
					const helpContent = /*[[${help.helpContent}]]*/;
					const helpNo = /*[[${help.helpNo}]]*/;
					const imageNm = /*[[${help.imageNm}]]*/;
					const doneYn = /*[[${help.doneYn}]]*/;
					const helpPlace = /*[[${help.helpPlace}]]*/;

					$('input[name=helpTitle]').attr('value', helpTitle);
					$('input[name=helpNo]').attr('value', helpNo);
					$('input[name=imageNm]').attr('value', imageNm);
					$("#helpContent").append(helpContent);
					$('input[name=helpPlace]').attr('value', helpPlace);
					$("input:radio[name='doneYn']:radio[value=" + doneYn + "]").prop("checked", true);

					const inputImage = document.getElementById("update-image")
					inputImage.addEventListener("change", e => {
						readUpdateImage(e.target)
					});
					
				};

			});

			function readImage(input) {
				// 인풋 태그에 파일이 있는 경우 
				if (input.files && input.files[0]) {
					// 이미지 파일인지 검사 (생략)
					// FileReader 인스턴스 생성
					const reader = new FileReader()
					// 이미지가 로드가 된 경우
					reader.onload = e => {
						const previewImage = document.getElementById("preview-image")
						previewImage.src = e.target.result
					}
					// reader가 이미지 읽도록 하기
					reader.readAsDataURL(input.files[0])
				}
			};

			function readUpdateImage(input) {
				// 인풋 태그에 파일이 있는 경우 
				if (input.files && input.files[0]) {
					// 이미지 파일인지 검사 (생략)
					// FileReader 인스턴스 생성
					const reader = new FileReader()
					// 이미지가 로드가 된 경우
					reader.onload = e => {
						const previewImage = document.getElementById("update-preview-image")
						previewImage.src = e.target.result
					}
					// reader가 이미지 읽도록 하기
					reader.readAsDataURL(input.files[0])
				}
			};
		</script>
	</th:block>

</head>
<!-- head 영역 끝 -->

<body>
	<div layout:fragment="content">
		<link rel="stylesheet" th:href="@{/css/boardTitle.css}" />
		<link rel="stylesheet" th:href="@{/css/help.css}" />

		<div class="v89_351" style="position: relative;">
			<!-- 화면 윗 부분 -->
			<div class="v89_238">
				<div class="v89_239" style="background-color: #cfe1fc;"></div>
				<div class="v89_240" style="background-color: #cfe1fc;"></div>
				<span class="v89_241">도와줘요</span>
			</div>
			<div class="v89_245">
				<img class="backImg" th:src="@{/images/boardBack_b.png}" />
			</div>
			<div class="v89_249">
				<img class="iconImg" th:src="@{/images/helpIcon.png}" />
			</div>

			<!-- 윗 부분 끝 -->

			<div id="insertHelp">
				<span class="subTitle">도움 청하기</span>

				<form id="insertForm" method="post" action="/help/insertHelp" enctype="multipart/form-data">
					<span class="v89_472">제목</span>
					<div class="v89_463">
						<input type="text" maxlength="27" class="HelpInput" name="helpTitle" placeholder="제목을 입력하세요.">
					</div>
					<input type="hidden" name="userNo" th:value="${session.loginUser.userNo}">
					<span class="v89_467">상세 주소</span>
					<div class="v89_465">
						<input type="text" class="HelpInput" name="helpPlace" placeholder="상세주소를 입력하세요.">
					</div>

					<span class="v89_468">진행 상태</span>
					<div class="conditionBtns">
						<input type="radio" id="condition1" name="doneYn" value="N" checked><label for="condition1">요청중</label>
						<input type="radio" id="condition2" name="doneYn" value="Y"><label for="condition2">해결완료</label>
					</div>

					<span class="v89_444">첨부 사진</span>
					<div class="filebox">
						<img style="width: 196px;" id="preview-image"
							src="https://dummyimage.com/500x500/ffffff/000000.png&text=preview+image">
						<label for="input-image">업로드</label>
						<input type="file" id="input-image" name="file">
					</div>

					<div class="v89_462">
						<textarea id="helpContentInput" class="helpContent" name="helpContent"
							placeholder="내용을 입력하세요."></textarea>
					</div>

					<button class="insertBtn" onclick="submit">등록</button>
				</form>
			</div>

			<div id="updateHelp">
				<span class="subTitle">도란장터 글 수정하기</span>

				<form id="updateForm" method="post" action="/help/updateHelp" enctype="multipart/form-data">
					<span class="v89_472">제목</span>
					<div class="v89_463">
						<input type="text" maxlength="27" class="HelpInput" name="helpTitle" placeholder="제목을 입력하세요.">
					</div>
					<input type="hidden" name="userNo" th:value="${session.loginUser.userNo}">
					<input id="helpNo" name="helpNo" type="hidden">
					<input id="imageNm" name="imageNm" type="hidden">
					<span class="v89_467">상세 주소</span>
					<div class="v89_465">
						<input type="text" class="HelpInput" name="helpPlace" placeholder="상세주소를 입력하세요.">
					</div>

					<span class="v89_468">진행 상태</span>
					<div class="conditionBtns">
						<input type="radio" id="condition3" name="doneYn" value="N" checked><label for="condition3">요청중</label>
						<input type="radio" id="condition4" name="doneYn" value="Y"><label for="condition4">해결완료</label>
					</div>

					<span class="v89_444">상품 사진</span>
					<div class="filebox">
						<div th:if="${help.imageNm eq null or help.imageNm.length < 1}}" th:remove="tag">
							<img style="width: 196px;" id="update-preview-image"src="https://dummyimage.com/500x500/ffffff/000000.png&text=preview+image">
						</div>
						<div th:if="${help.imageNm ne null and help.imageNm.length > 0}" th:remove="tag">
							<img style="width: 196px;" id="update-preview-image"
								th:src="@{'/helpImg/' + ${help.imageNm}}">
						</div>
						<label for="update-image">업로드</label>
						<input type="file" id="update-image" name="file">
					</div>

					<div class="v89_462">
						<textarea id="helpContent" class="helpContent" name="helpContent"
							placeholder="내용을 입력하세요."></textarea>
					</div>

					<button class="insertBtn" onclick="submit">등록</button>
				</form>
			</div> 

			<button class="cancelBtn" onclick="location.href='/help/selectHelpList'">취소</button>
		</div>


	</div>
</body>



</html>