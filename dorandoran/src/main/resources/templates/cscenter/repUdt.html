<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout-cs}">

<!-- head 영역 시작 -->
<!-- 개별적으로 사용할 css, js 링크 걸기 위해 남겨둠 -->

<head>
	<th:block layout:fragment="css">
		<link rel="stylesheet" th:href="@{/css/csmain.css}" />
	</th:block>
	<th:block layout:fragment="script">
		<script th:src="@{/js/jquery-3.6.1.min.js}"></script>
		<script th:inline="javascript">
			$(function () {
				const loginUser = /*[[${loginUser}]]*/;
				const userNm = /*[[${rDetail.userNm}]]*/;
				console.log(loginUser);

				if (loginUser == null) {
					alert("로그인이 필요한 기능입니다. 로그인 페이지로 이동합니다.");
					window.location.href = "/cscenter/loginPage";
				} else if (loginUser != null) {
					const loginUserNm = loginUser.userNm;
					if (loginUserNm != userNm) {
						$("#btnUpdate").hide();
						alert("잘못된 접근방식입니다.");
						window.location.href = "/cscenter/repList";
					}
				}
			})
			function fnUpdateBoard() {
				if ($("#repTitle").val().length == 0) {
					alert("제목을 입력해주세요.");
					$("#insertInp").focus();
					return false;
				}
				if ($("#texta1").val().length == 0) {
					alert("내용을 입력해주세요.");
					$("#texta1").focus();
					return false;
				}
				$.ajax({
					url: '/cscenter/report',
					type: 'put',
					data: $("#updateForm").serialize(),
					success: function (obj) {
						alert("수정되었습니다.");
						const repNo = /*[[${rDetail.repNo}]]*/;
						window.location.href = "/cscenter/report/[[${repNo}]]";
					},
					error: function (e) {
						console.log(e);
					}
				});
			}
			$(document).ready(function () {
				$('#texta1').on('keyup', function () {
					$('#text_cnt').html($(this).val().length + " / 500");

					if ($(this).val().length > 500) {
						$(this).val($(this).val().substring(0, 500));
						$('#text_cnt').html("500 / 500");
					}
				});
				$('#repTitle').on('keyup', function () {
					if ($(this).val().length > 20) {
						$(this).val($(this).val().substring(0, 20));
					}
				});
			});
		</script>
	</th:block>
</head>
<!-- head 영역 끝 -->

<body>
	<div layout:fragment="content">
		<div class="item--68N">
			<div class="auto-group-e12j-mkJ">
				<img class="ellipse-3-VAW" src="/images/ellipse-3-fwC.png" />
				<img class="customer-survey-amico-1-dGi" src="/images/customer-survey-amico-1-3La.png" />
				<div class="item--kcE">고객센터</div>
			</div>
			<div class="auto-group-hv9g-23x">
				<div class="rectangle-23-xiJ">
					<div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
						<div id="tpImg2">
							<div>
								<img th:src="@{/images/-ib8.png}" style="width : 80px; height : 80px;">
							</div>
							<div>
								<span id="listTtl2">수정하기</span>
							</div>
						</div>
						<form id="updateForm">
							<input type="hidden" name="repNo" id="repNo" th:value="${rDetail.repNo}">
							<input type="hidden" name="inputDtm" id="inputDtm" th:value="${rDetail.inputDtm}">
							<table style="border-collapse: collapse; margin-top : 10px;">
								<tr>
									<td id="udtQTag">
										제목
									</td>
									<td id="udtQTag2">
										<input type="text" name="repTitle" id="repTitle" th:value="${rDetail.repTitle}"
											style="outline:none;">
									</td>
								</tr>
								<tr>
									<td id="udtQTag">
										작성자
									</td>
									<td id="udtQTag2">
										[[${rDetail.userNm}]]
									</td>
								</tr>
								<tr>
									<td id="udtQTag">
										작성일
									</td>
									<td style="text-align: left; background:  white;" id="inputDtmText" class="udtQTag3"
										th:text="${rDetail.inputDtm eq null ? '' : #strings.substring(rDetail.inputDtm, 0, 10)}">
									</td>
								</tr>
								<tr>
									<td id="udtQTag">
										내용
									</td>
									<td id="udtQTag2">
										<textarea name="repContent" id="texta1" cols="40" rows="10"
											th:text="${rDetail.repContent}"
											style="width:575px; height:340px; outline:none;"></textarea>
									</td>
								</tr>
								<tr>
									<td id="udtQTag">
										글자수 제한
									</td>
									<td style="text-align: right;" id="udtQTag2">
										<div id="text_cnt" style="background : white;">0 / 500</div>
									</td>
								</tr>
							</table>
							<div id="istTagB">
								<a name="qNo" id="updateBtn"
									th:href="@{/cscenter/report/{repNo} (repNo=${rDetail.repNo})}"
									onclick="alert('작성 중인 글은 삭제됩니다.')">취소</a>
								<button type="button" id="btnUpdate"
									th:onclick="fnUpdateBoard(); return false;">수정</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>